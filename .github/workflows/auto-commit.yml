name: Auto Commit

on:
  push:
    branches:
      - "**"

jobs:
  auto-commit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          distribution: "temurin"
          java-version: "17"

      - name: Find modified Java file
        id: java_file
        run: |
          FILE=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep '\.java$' | head -n 1)
          echo "file=$FILE" >> $GITHUB_OUTPUT

      - name: Extract info, compile, run, and commit
        run: |
          FILE=${{ steps.java_file.outputs.file }}
          echo "Java File: $FILE"

          DIR=$(dirname "$FILE" | sed 's|algorithm/||')
          BASENAME=$(basename "$FILE" .java)

          ID=$(echo $BASENAME | grep -o 'BOJ[0-9]*' | sed 's/BOJ//')
          TITLE=$(echo $BASENAME | sed -E 's/.*BOJ[0-9]+_//;s/_/ /g')

          # ÎùºÏù∏ Ïàò Í≥ÑÏÇ∞
          LINES=$(wc -l < "$FILE")

          # ÌååÏùº Ïª¥ÌååÏùº
          javac "$FILE"
          CLASSNAME=$(basename "$FILE" .java)
          OUT=$(java -cp $(dirname "$FILE") "$CLASSNAME")

          # Ïã§Ìñâ ÏãúÍ∞Ñ Ï∂îÏ∂ú
          TIME_LINE=$(echo "$OUT" | grep 'TIME:')
          TIME_VAL=$(echo "$TIME_LINE" | grep -o '[0-9]* ms')

          # Ïª§Î∞ã Î©îÏãúÏßÄ
          MSG="‚ú® $DIR: BOJ$ID $TITLE\nüìè ${LINES} lines\n‚è±Ô∏è $TIME_VAL"
          echo -e "$MSG"

          git config user.name github-actions
          git config user.email github-actions@github.com
          git add "$FILE"
          git commit -m "$MSG"
          git push
